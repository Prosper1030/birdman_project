# Birdman Project Requirements.md

## 專案概述

Birdman Project 是一個面向成功大學航空太空工程系學生組織的專案管理系統，核心目標是為人力飛機設計與製造提供科學化、自動化的專案管理解決方案。系統採用 Python 3.10+ 開發，整合 DSM 依賴分析、WBS 工作分解、CPM 關鍵路徑分析、RCPSP 資源受限排程與蒙地卡羅風險模擬等核心功能。

### 核心挑戰與需求背景

人力飛機專案具有以下特殊挑戰：
- **多領域技術整合**：涉及空氣動力學、結構工程、製造工藝、人因工程等
- **學生團隊特性**：成員流動性大、經驗水平差異顯著、跨屆知識傳承困難
- **資源限制嚴格**：有限的時間、預算與人力配置
- **複雜依賴關係**：任務間存在大量技術依賴與資源衝突

因此系統需要提供高度自動化的排程與風險分析能力，同時確保知識可傳承、流程可追溯。

## 系統架構與技術規格

### 核心技術棧

**開發語言與平台**
- Python 3.10+ 作為主要開發語言
- 支援 Windows、Linux、macOS 跨平台運行
- UTF-8 編碼確保中文支援

**核心依賴庫**
- pandas: 資料處理與 CSV 操作
- networkx: 圖論分析與依賴關係處理
- numpy: 數值計算與統計分析
- matplotlib: 圖表繪製與視覺化
- PyQt5: 圖形介面開發
- OR-Tools: RCPSP 最佳化求解
- scipy: 科學計算與統計分佈

**資料儲存格式**
- CSV 檔案作為主要資料交換格式
- Markdown 檔案用於日誌記錄與知識傳承
- JSON 設定檔管理系統參數
- Git 版本控制確保資料可追溯性

### 系統分層架構

**資料管理層 (Data Management Layer)**
- 負責 CSV 檔案的讀寫與驗證
- 提供資料一致性檢查與格式轉換
- 實現版本控制與變更追蹤
- 支援 DSM、WBS、Resources 等標準格式

**演算法運算層 (Algorithm Processing Layer)**
- DSM 拓撲排序與強連通分量分析
- CPM 關鍵路徑計算與時程分析
- RCPSP 資源受限排程最佳化
- 蒙地卡羅模擬與風險評估
- WBS 任務合併與工時計算

**呈現互動層 (Presentation & Interaction Layer)**
- CLI 命令列介面支援批次處理
- PyQt5 圖形介面提供即時互動
- 視覺化圖表生成與匯出功能
- RESTful API 支援系統整合

## 學術行事曆整合系統

### 技術標準與 API 整合

學術環境的專案管理必須考慮課程安排、考試時程、假期等複雜時間約束。系統需要實作多層次的行事曆整合功能，提供即時同步與衝突解決機制。

**核心協定實作**
- **CalDAV (RFC 4791)**：主要行事曆協定，支援 XML 操作與遠端存取
- **Google Calendar API**：整合 OAuth 2.0、推播通知與批次操作
- **Microsoft Graph Calendar API**：支援 Microsoft 365 生態系統
- **iCalendar (RFC 5545)**：跨平台行事曆資料交換標準

**學術特化行事曆建模**

**階層式資料結構**
```
學年 (Academic Year)
├── 學期/學季 (Semesters/Terms)
│   ├── 課程 (週期性課程安排)
│   ├── 考試期間 (覆蓋性約束)
│   ├── 作業截止日 (專案里程碑)
│   └── 校園活動 (資源衝突)
└── 學術行事曆例外 (假期、停課)
```

**複雜週期性處理**
- **多層級時間區塊**：處理課程、辦公時間、考試期間的時間分配
- **例外管理**：處理假期中斷的正常排程
- **資源約束整合**：考慮教室容量、設備使用與交通時間

**衝突偵測與同步機制**

**進階衝突偵測**
系統使用區間樹 (Interval Tree) 實作，提供 O(log n + k) 複雜度的大規模衝突偵測：
- **多因子分析**：時間重疊、資源可用性、參與者驗證、容量限制
- **優先級解決**：基於學術階層（核心課程 > 選修課程 > 選擇性活動）
- **智慧排程建議**：提供替代時間方案與資源重新分配建議

**即時同步架構**
- **Webhook 推播通知**：即時行事曆更新機制
- **同步權杖實作**：高效增量同步處理
- **多源聯合**：同時處理 Google、Outlook、機構與個人行事曆

**學生可用性動態建模**

**可用性預測演算法**
```python
class AcademicAvailabilityPredictor:
    def predict_availability(self, student_id, time_window):
        """
        基於學術行事曆預測學生可用性
        
        考慮因素:
        - 課程固定時間
        - 考試期間影響
        - 作業截止壓力
        - 歷史參與模式
        """
        base_availability = self.get_course_schedule(student_id, time_window)
        exam_impact = self.calculate_exam_stress_factor(time_window)
        assignment_load = self.assess_assignment_pressure(time_window)
        historical_pattern = self.analyze_participation_history(student_id)
        
        return self.weighted_availability_score(
            base_availability, exam_impact, assignment_load, historical_pattern
        )
```

**時間窗口最佳化**
系統需要處理學生在不同時期的可用性變化：
- **學期初期**：較高可用性，適合專案啟動與規劃
- **期中考期**：大幅減少可用性，需要彈性調整任務安排
- **學期末期**：考試與報告壓力，專案收尾活動需要特別規劃

### WBS (Work Breakdown Structure) 格式規範

**必要欄位定義**
- `Task_ID`: 任務唯一識別碼，採用「屬性代號年份-流水號」格式（如 A26-001）
- `Name`: 任務名稱，支援中英文描述
- `TRF`: 任務風險因子 (Task Risk Factor)，範圍 0-1
- `Property`: 任務屬性分類，對應資源群組與技能領域
- `Eligible_Groups`: 可執行該任務的組別清單
- `ResourceDemand`: 資源需求量，整數值

**工時估算欄位**
系統支援專家與新手兩種角色的四點估時法：
- `O_expert/O_newbie`: 樂觀工時
- `M_expert/M_newbie`: 最可能工時  
- `P_expert/P_newbie`: 悲觀工時
- `Te_expert/Te_newbie`: 期望工時

**任務分類代號系統**
- `0X`: 系統級別任務（初期探討、制度設計等）
- `A`: 流力任務（空氣動力學分析與設計）
- `S`: 結構任務（機體設計、有限元素分析等）
- `D`: 傳動任務（人力傳輸鏈條、踏板系統等）
- `C`: 控制任務（控制面、感測器、控制系統等）
- `O`: 文書任務（公關、文件、採購等）
- `B`: 實作任務（製作、加工、裝配等）
- `T`: 測試任務（地面/飛行測試、材料試驗等）
- `X`: 跨屬性協調（會議、設計審查等）
- `E`: 總工程師任務（系統架構、整合分析等）
- `P`: 專案管理任務（進度追蹤、版本管理等）
- `L`: 隊長任務（資源爭取、戰略決策等）
- `M`: 臨時工作包（合併後的虛擬任務）

### DSM (Design Structure Matrix) 格式規範

**矩陣結構要求**
- 必須為 N×N 方陣，行列數相等
- 第一行為 Task_ID 列表
- 第一列為 Task_ID 列表
- 矩陣值為 0 或 1，其中 1 表示行任務依賴列任務

**依賴關係語義**
- DSM[i,j] = 1 表示任務 i 必須等待任務 j 完成
- 系統自動檢測循環依賴並提供修正建議
- 支援依賴關係的視覺化展示與編輯

### Resources 資源配置格式

**資源定義欄位**
- `Group`: 資源群組名稱
- `Hr_Per_Week`: 每週可投入工時
- `Headcount_Cap`: 人力上限
- `備註`: 額外說明資訊

**資源容量計算邏輯**
系統優先使用 `Headcount_Cap` 作為並行任務數量上限。若該欄位為空，則根據 `Hr_Per_Week` 除以任務平均工期估算可並行任務數，最低為 1。

## 核心功能模組規範

### DSM 處理與依賴分析

**拓撲排序功能**
- 將 DSM 轉換為下三角矩陣
- 執行拓撲排序確定任務執行順序
- 檢測並處理循環依賴問題

**強連通分量 (SCC) 分析**
- 使用 Tarjan 演算法識別強連通分量
- 為每個任務分配 SCC_ID 與 Layer 層次
- 支援 SCC 內任務的自動合併處理

**依賴關係視覺化**
- 生成分層式依賴關係圖
- 支援 SCC 群組的顏色標示
- 提供 SVG/PNG 格式匯出功能

### 視覺化 DSM 創建與管理 (Visual DSM Creation & Management)

基於 yEd 圖形編輯器深度技術分析，系統提供一個完整的視覺化依賴關係編輯環境，支援從圖形化互動到 DSM 矩陣反向生成的端到端工作流程。

#### **圖形化互動介面**

**畫布與基礎操作**
- 提供無限滾動的工作畫布，支援平移（滑鼠右鍵拖曳或中鍵拖曳）與縮放（滑鼠滾輪）操作
- 整合網格線顯示與對齊網格功能，輔助精確的手動對齊
- 實作基於狀態機的互動邏輯，確保操作流暢性與一致性

**節點（任務）管理**
- 支援兩種節點建立方式：從元件面板拖放預定義圖形，或在畫布背景單擊快速建立
- 每個節點支援可編輯的多行文字標籤，包含雙擊編輯和 F2 快速編輯功能
- 實現標準滑鼠手勢的選取、移動、縮放操作，支援 SHIFT/CTRL 多重選取
- 提供屬性面板用於編輯節點顏色、形狀、尺寸及自訂資料欄位（如負責人、狀態等）

**邊（依賴關係）管理**
- 透過從源節點拖曳至目標節點的直觀方式建立有向依賴邊
- 提供即時視覺回饋：拖曳過程中顯示「橡皮筋」預覽線，目標節點懸停高亮
- 支援 ESC 鍵或滑鼠右鍵取消邊建立操作
- 邊支援可編輯文字標籤，並可建立多段式折線路徑

#### **自動佈局演算法**

系統整合三種核心佈局演算法，每種針對不同的專案管理情境：

**階層式佈局 (Hierarchical Layout)**
- 基於 Sugiyama-style 演算法，將節點分配到不同層級以突顯任務流向
- 適用場景：PERT/CPM 分析、瀑布式專案計畫、工作流程圖
- 特點：清晰展示任務執行序列，便於識別要徑

**正交佈局 (Orthogonal Layout)**
- 採用網格式佈局，所有邊線均為水平/垂直線段，轉角為 90 度
- 適用場景：複雜依賴關係圖、系統架構視覺化、組織溝通路徑
- 特點：極度清晰整潔，最大限度減少歧義

**力導向佈局 (Force-Directed/Organic Layout)**
- 基於物理模擬的自然佈局，透過吸引力與排斥力達到平衡狀態
- 適用場景：敏捷專案管理、任務叢集發現、瓶頸分析
- 特點：自動識別高度耦合的任務群組，揭示隱藏的內在結構

#### **DSM 反向生成**

**核心轉換流程**
- 將視覺化圖形轉換為標準 N×N DSM 矩陣，其中 N 為任務總數
- 矩陣語義：Matrix[i,j] = 1 表示任務 i 是任務 j 的前置依賴項
- 支援即時預覽：編輯過程中可隨時查看對應的 DSM 矩陣狀態
- 提供雙向同步：從 DSM 矩陣重新載入到視覺化編輯器

**匯出與整合功能**
- 生成的 DSM 矩陣可儲存為標準 CSV 檔案格式
- 在應用程式內提供表格視圖顯示完整矩陣
- 與現有 DSM 處理模組無縫整合，支援後續拓撲排序與 SCC 分析

#### **推薦技術棧**

**圖形視覺化**：`PyQtGraph`
- 基於 Qt 原生 QGraphicsView 框架，為即時互動提供卓越性能
- 優於 Matplotlib 的靜態圖表生成，專為流暢編輯體驗最佳化

**後端圖形管理**：`NetworkX`
- Python 圖形結構操作的事實標準函式庫
- 提供強健的 DiGraph 物件和鄰接矩陣匯出功能
- 內建 `to_numpy_array()` 函式是 DSM 生成的核心

**資料處理**：`NumPy`
- 作為 NetworkX 匯出目標格式和最終 DSM 資料結構
- 高效的矩陣運算支援

#### **實作架構概要**

系統採用 MVC 架構模式，嚴格分離 UI 邏輯與資料分析邏輯：
1. **視圖層 (PyQtGraph/QGraphicsScene)**：處理使用者互動事件，發出自訂信號
2. **控制器層**：響應信號，協調模型與視圖的同步更新
3. **模型層 (NetworkX.DiGraph)**：維護圖形資料結構，支援獨立的儲存、載入與分析

**詳細技術規格與實作藍圖**：完整的互動邏輯狀態機設計、底層資料架構、佈局演算法原理分析與端到端實作指南，請參閱專門的技術分析文件：[視覺化 DSM 編輯器技術分析報告](designs/visual_dsm_editor_analysis.md)。

### WBS 資料互動與編輯

**雙模式資料編輯功能**

**預覽模式 (Preview Mode)**
- 現有的唯讀表格視圖，作為系統預設模式
- 提供資料瀏覽、排序、篩選等基本檢視功能
- 支援快速資料驗證與格式檢查

**編輯模式 (Editing Mode)**
- 類似 Excel 的即時儲存格編輯介面
- 支援滑鼠點擊或雙擊進入編輯狀態
- 即時資料驗證：不符合格式的輸入即時標記提醒
- 復原/重做功能：支援多步驟操作復原
- 批次操作：支援多選儲存格的批次修改

**進階儲存格運算功能**
- 基礎數學函數：SUM()、AVERAGE()、MIN()、MAX()
- 條件運算：IF()、COUNT()、COUNTIF()
- 跨欄位引用：支援同行其他欄位的動態引用
- 公式顯示模式：可切換顯示公式或計算結果

**即時存檔與版本管理**
- 自動儲存：編輯過程中定期自動儲存到 .csv 檔案
- 手動存檔：Ctrl+S 立即將變更寫回原始檔案
- 變更追蹤：記錄所有修改操作的時間戳記與變更內容
- 備份機制：自動建立編輯前的檔案備份

**任務管理功能**
- 新增任務：在表格末尾或指定位置插入新列
- 刪除任務：支援單列或多列刪除，含依賴關係檢查警告
- 複製貼上：支援任務資料的複製與批次建立
- 拖拽排序：直接拖拽列來調整任務順序

**自動化 WBS 欄位處理**

**Property 欄位自動生成**
- 智慧解析：當匯入的 WBS 檔案缺少 Property 欄位時自動觸發
- Task_ID 模式識別：自動從 Task_ID（例如 A26-001）中提取前綴字母（A）
- 批次處理：一次性為所有任務建立 Property 欄位
- 使用者控制：此功能設計為可選，預設啟用，可透過設定關閉
- 異常處理：對於無法解析的 Task_ID 格式提供手動修正選項

**Task_ID 自動編號系統**
- 智慧編號：新增任務時使用者只需填寫 Property 和 Name 欄位
- 流水號檢測：系統自動檢測該 Property 分類下的最大現有流水號
- 自動生成：產生下一個可用的 Task_ID（例如：已存在 S26-015，自動生成 S26-016）
- 年份適應：支援跨年度專案的年份自動切換
- 衝突避免：確保不會產生重複的 Task_ID
- 自訂格式：支援使用者自訂 Task_ID 的命名格式模板

### WBS 任務管理與合併

**任務合併演算法**
當多個任務屬於同一 SCC 時，系統執行自動合併：

**合併後任務 ID 命名規則**
```
M<年份>-<流水號>[<原Task_ID列表>]
例：M25-001[A25-003,D25-006,C25-007]
```

**工時係數計算公式**
```
k = base + sqrt((ΣTRF / n) * trf_scale) / trf_divisor + n_coef * (n - 1)
```
其中：
- `ΣTRF`: 合併任務的 TRF 總和
- `n`: 合併任務數量
- `base`: 基礎係數（預設 1.0）
- `trf_scale`: TRF 縮放係數
- `trf_divisor`: 除數因子
- `n_coef`: 數量係數

**合併後工時計算**
所有工時欄位（O/M/P/Te 的 expert/newbie 版本）均乘以計算得出的工時係數 k。

### TRF (Task Risk Factor) 評估系統

**三維風險評估架構**

**技術新穎性 (Novelty) - 權重 40%**
評估技術或方法對整個工程領域的新穎程度：
- 1分：成熟的標準工程問題，有完整解決方案參考
- 3分：有部分參考案例，但需要適度創新或調整
- 5分：前沿技術問題，缺乏現成參考，挑戰物理極限

**內在複雜度 (Complexity) - 權重 40%**
評估專家執行任務時需要管理的變數複雜程度：
- 1分：線性、直接的任務，變數間關係簡單
- 3分：涉及多個相互作用的系統，需要權衡不同目標
- 5分：高度整合性任務，涉及多物理場耦合、多重衝突目標

**外部依賴性 (Dependency) - 權重 20%**
評估任務成功對其他高風險任務產出的依賴程度：
- 1分：可獨立完成的任務，不依賴其他探索性任務
- 3分：依賴部分其他任務的產出，但具有替代方案
- 5分：高度依賴其他高風險探索性任務的輸出

**TRF 計算公式**
```
TRF = (Novelty × 0.4 + Complexity × 0.4 + Dependency × 0.2) / 5
```

### PERT 工時估算系統

**Beta 分佈參數設定**
基於 TRF 動態調整樂觀與悲觀時間：

```
O = 0.5 + 0.5 × TRF^2.5
P = 1.2 + 1.3 × TRF^2
```

**期望工時計算**
採用 Beta-PERT 公式：
```
Te = (O + 4M + P) / 6
```

**新手係數動態調整**
根據任務類別與 TRF 計算新手工時係數：

```
K_adjusted = K_min + (K_max - K_min) × TRF
K_min = 0.85 × K_base
K_max = 1.15 × K_base
```

各類別基準係數：
- A, S, D, 0X: 3.0
- C: 2.8  
- T: 2.2
- B: 2.0
- O: 1.8
- X: 1.5

### CPM 關鍵路徑分析

**正向計算 (Forward Pass)**
計算每個任務的最早開始時間 (ES) 與最早完成時間 (EF)：
```
ES[task] = max(EF[predecessor] for predecessor in predecessors)
EF[task] = ES[task] + duration[task]
```

**反向計算 (Backward Pass)**
基於專案總工期計算最晚開始時間 (LS) 與最晚完成時間 (LF)：
```
LF[task] = min(LS[successor] for successor in successors)
LS[task] = LF[task] - duration[task]
```

**鬆弛時間計算**
- 總鬆弛時間 (Total Float): `TF = LS - ES`
- 自由鬆弛時間 (Free Float): `FF = min(ES[successor]) - EF[task]`
- 關鍵任務識別：TF = 0 的任務構成關鍵路徑

**多情境分析支援**
系統支援以下工時組合的 CPM 分析：
- 新手/專家 × 樂觀/最可能/悲觀/期望工時
- 總計 8 種情境組合
- 預設使用「新手-期望工時」情境

### RCPSP 資源受限排程

**問題建模**
將專案排程建模為混合整數規劃問題：
- 決策變數：每個任務的開始時間
- 約束條件：任務依賴關係 + 資源容量限制
- 目標函數：最小化專案總工期

**OR-Tools 求解器參數**
- 求解時間上限：10 秒（可調整）
- 時間範圍：0 到所有任務工期總和
- 資源需求：支援離散資源與可再生資源模型

**排程結果輸出**
- 各任務的最佳開始時間
- 專案總工期 (ProjectEnd)
- 資源利用率統計
- RCPSP 甘特圖視覺化

### RACP 反推最小人力配置

**核心概念與數學基礎**
RACP (Resource Availability Cost Problem) 解決「給定專案期限，求最小資源配置」的反向優化問題。與 RCPSP 的正向排程不同，RACP 通過反推分析確定達成目標期限所需的最低人力投入。

**數學模型框架**
```
最小化: Σ(資源成本 × 資源配置量)
約束條件:
- 專案完工時間 ≤ 目標期限
- 任務依賴關係約束
- 資源能力約束
- 多技能群組成員約束
```

**多技能群組成員建模**
系統支援成員同時隸屬多個技能群組的複雜情境：

**資源能力矩陣設計**
```python
class MultiSkillResource:
    skill_groups: List[str]          # 所屬技能群組
    proficiency_levels: Dict[str, float]  # 各群組熟練度
    switch_costs: Dict[str, Dict[str, float]]  # 群組切換成本
    availability_windows: List[TimeSlot]       # 可用時間窗口
    learning_curve: Dict[str, float]           # 技能學習曲線
```

**階層式技能框架**
- 技能等級約束：任務需要最低技能門檻，資源具備不同群組內的技能等級
- 動態技能發展：技能水平隨時間與經驗累積而提升
- 跨群組技能轉移：相關技能域間的能力轉移係數

**RACP 演算法實作策略**

**分層演算法架構**
基於問題規模採用不同最佳化策略：
- **小型專案（≤30 任務）**：精確解法（MILP 或 CP 求解器）
- **中型專案（30-100 任務）**：混合後設啟發式演算法
- **大型專案（100+ 任務）**：純後設啟發式搭配局部搜尋

**核心演算法組合**
- **改良最小界限演算法 (Modified Minimum Bounding Algorithm)**：用於小型專案的精確解
- **混合後設啟發式**：結合粒子群最佳化與分散搜尋法
- **約束規劃模型**：使用延遲子句生成技術處理複雜約束

**學生團隊適應性建模**

**彈性資源檔案實作 (Flexible Resource Profiles)**
針對學生團隊的動態特性設計：

```python
class StudentAvailability:
    weekly_hours: int                    # 每週總投入時數
    daily_slots: Dict[Day, List[TimeSlot]]  # 每日具體可用時段
    skill_development: Dict[str, LearningCurve]  # 動態能力成長
    commitment_factor: Dict[TimeWindow, float]   # 變動生產力係數
    academic_constraints: AcademicCalendar      # 學術行事曆限制
```

**多技能資源約束 (Multi-Skilled RCPSP)**
- **時間相依技能等級**：`技能等級[學生][技能][時間] = 基礎技能 + 學習率 × 時間`
- **技能廣度與深度追蹤**：不同能力等級的效率乘數
- **交叉訓練最佳化**：考慮相關領域間的技能轉移係數

**求解效能指標**
- **回應時間目標**：資源可用性查詢需在 1 秒內完成
- **最佳化運算時間**：複雜多專案情境下 10 分鐘內完成
- **可擴展性支援**：支援 500+ 任務的大型專案分析

**二分搜尋法整合實作**
```python
def solve_racp_binary_search(tasks, dependencies, deadline):
    """
    使用二分搜尋法求解 RACP 問題
    
    參數:
        tasks: 任務清單
        dependencies: 依賴關係圖
        deadline: 目標完工期限
    
    回傳:
        minimum_resources: 最小資源配置
        sensitivity_analysis: 邊際效益分析
    """
    min_resources = estimate_lower_bound(tasks)
    max_resources = estimate_upper_bound(tasks)
    
    while max_resources - min_resources > tolerance:
        mid_resources = (min_resources + max_resources) / 2
        completion_time = solve_rcpsp(tasks, dependencies, mid_resources)
        
        if completion_time <= deadline:
            max_resources = mid_resources
        else:
            min_resources = mid_resources
    
    return optimize_resource_allocation(max_resources)
```

**敏感度分析與邊際效益**
系統提供各組別人力調整的影響評估：
- 各技能群組增減一人對工期的影響
- 資源配置的邊際成本效益分析
- 技能群組間的替代性分析報告

### 蒙地卡羅風險分析

**隨機分佈建模**
採用 Beta-PERT 分佈進行工期隨機化：
```
μ = (O + 4M + P) / 6
α = 1 + 4 × (μ - O) / (P - O)  if μ ≠ O else 1
β = 1 + 4 × (P - μ) / (P - O)  if μ ≠ P else 1
```

**模擬執行流程**
1. 為每個任務從其 Beta-PERT 分佈隨機抽樣工期
2. 執行 CPM 計算該情境下的專案完工時間
3. 重複 N 次（預設 1000 次）收集完工時間樣本
4. 計算統計指標與風險評估

**統計輸出指標**
- 平均完工時間與標準差
- 信心水準完工時間（P50, P85, P95）
- 完工時間分佈直方圖
- 各任務工期敏感度分析

## 使用者介面規範

### CLI 命令列介面

**核心指令結構**
```bash
python main.py --dsm <DSM檔案> --wbs <WBS檔案> [選項]
```

**主要參數選項**
- `--config`: 指定設定檔路徑（預設 config.json）
- `--cmp`: 執行 CPM 分析
- `--monte-carlo N`: 執行蒙地卡羅模擬 N 次
- `--rcpsp-opt`: 執行 RCPSP 排程
- `--resources`: 指定資源檔案路徑
- `--export-*`: 各類圖表與結果匯出選項

**批次處理支援**
CLI 支援與 CI/CD 系統整合，可用於自動化專案分析與報告生成。

### PyQt5 圖形介面

**主分頁結構**
1. **設定與輸入分頁**：檔案選擇、預覽與基本設定
2. **分析結果分頁**：包含 9 個子分頁展示各項分析結果

**分析結果子分頁**
- 排序 WBS/DSM：展示拓撲排序後的任務與依賴矩陣
- 依賴關係圖：原始任務依賴關係的視覺化展示
- 合併 WBS/DSM：展示 SCC 合併後的結果
- 合併後依賴圖：含關鍵路徑標示的合併依賴圖
- CPM 分析結果：詳細的關鍵路徑分析報告
- 甘特圖：支援多情境切換的動態甘特圖
- 蒙地卡羅模擬：次數模式與密度模式雙重圖表
- 進階分析：RCPSP 排程與其他高級功能

**即時互動功能**
- 主題切換：深色/淺色模式一鍵切換

**WBS 資料互動介面規範**

**雙模式切換機制**
- 模式切換按鈕：在 WBS 預覽分頁顯著位置提供「切換至編輯模式」按鈕
- 狀態指示器：清楚標示當前處於預覽模式或編輯模式
- 安全確認：切換至編輯模式前提供資料備份提醒與確認對話框

**編輯模式 GUI 元件**
- Excel 風格表格：可編輯的儲存格，支援點擊與雙擊編輯
- 公式輸入列：類似 Excel 的公式編輯列，顯示與編輯儲存格公式
- 工具列：包含常用功能按鈕（新增列、刪除列、復原、儲存等）
- 狀態列：顯示當前選取儲存格資訊與編輯狀態

**任務管理操作介面**
- 右鍵選單：提供插入列、刪除列、複製、貼上等快速操作
- 拖拽操作：支援滑鼠拖拽調整列順序
- 批次選取：支援 Ctrl+Click 與 Shift+Click 多選操作
- 快速填入：支援儲存格資料的下拉填入與自動填入功能

**自動化處理 GUI 整合**
- Property 自動生成對話框：當檢測到缺少 Property 欄位時彈出
- Task_ID 自動編號設定：提供編號規則自訂與預覽功能
- 進度指示器：批次處理時顯示處理進度與狀態

**DSM 視覺化編輯器介面規範**

**畫布區域設計**
- 無限滾動畫布：支援滑鼠滾輪縮放與中鍵拖拽平移
- 網格系統：可切換顯示/隱藏的對齊網格
- 導航小地圖：右下角提供全域視圖縮略圖
- 工具面板：左側或上方提供編輯工具與佈局選項

**節點操作介面**
- 節點自動生成：WBS 匯入後自動在畫布上生成所有任務節點
- 節點自訂工具：顏色、大小、形狀的調整面板
- 連接操作：滑鼠懸停時顯示連接點，拖拽建立箭頭連線
- 選取與多選：支援框選、Ctrl 多選等標準選取操作

**佈局控制介面**
- 佈局工具列：提供分層、正交、力導向等自動佈局按鈕
- 對齊工具：左對齊、右對齊、均勻分佈等精確對齊功能
- 層次管理：支援節點的前景/背景層次調整
- 群組功能：支援節點群組化與群組統一操作

**DSM 矩陣同步顯示**
- 分割視窗：畫布與 DSM 矩陣表格並排顯示
- 即時同步：視覺化編輯時 DSM 矩陣即時更新
- 雙向編輯：支援直接在 DSM 矩陣中編輯並同步到視覺化
- 衝突檢測：循環依賴等問題的即時視覺提醒
- 情境切換：CPM 與甘特圖的 8 種情境即時切換
- 參數調整：k 係數參數的即時調整與預覽
- 匯出功能：支援 CSV、Excel、PNG、SVG 多種格式

### RESTful API 規範

**核心端點設計**
- `GET/POST /tasks`: 任務資料的查詢與提交
- `GET/POST /resources`: 資源資料的管理
- `POST /schedule`: 觸發排程計算
- `POST /risk`: 執行蒙地卡羅風險分析
- `GET /logs`: 歷史操作日誌查詢

**認證與權限**
支援 OAuth2 或 JWT 認證機制，確保 API 存取安全。

**資料格式**
採用標準 JSON 格式進行資料交換，包含狀態碼與錯誤訊息處理。

## 專案檔案存檔系統

### 存檔格式與結構

**Birdman Project 檔案 (.bpx)**
系統採用自訂的 `.bpx` 檔案格式（Birdman Project eXchange），內部為 ZIP 壓縮的 JSON 結構，包含完整的專案狀態與分析結果。

**檔案內部結構**
```
project_name.bpx (ZIP 格式)
├── project_metadata.json     # 專案基本資訊
├── wbs_data.json            # WBS 任務資料
├── dsm_data.json            # DSM 依賴矩陣
├── resources_data.json      # 資源配置資料
├── analysis_results/        # 分析結果目錄
│   ├── cpm_results.json     # CPM 分析結果
│   ├── rcpsp_schedule.json  # RCPSP 排程結果
│   ├── monte_carlo.json     # 蒙地卡羅模擬結果
│   └── racp_analysis.json   # RACP 分析結果
├── config/                  # 設定檔目錄
│   ├── merge_params.json    # 合併參數設定
│   ├── visual_params.json   # 視覺化參數
│   └── system_config.json   # 系統設定
└── attachments/             # 附件目錄
    ├── gantt_charts/        # 甘特圖匯出
    ├── dependency_graphs/   # 依賴關係圖
    └── reports/            # 分析報告
```

**專案後設資料格式**
```json
{
  "project_info": {
    "name": "人力飛機設計專案",
    "version": "1.0.0",
    "created_date": "2024-01-15T10:30:00Z",
    "last_modified": "2024-03-20T14:45:00Z",
    "description": "2024年鳥人間大賽參賽作品",
    "team_members": ["張三", "李四", "王五"],
    "project_deadline": "2024-07-31T23:59:59Z"
  },
  "file_format_version": "2.1",
  "birdman_system_version": "1.5.2",
  "data_integrity": {
    "checksum": "sha256:a1b2c3d4...",
    "validation_status": "verified"
  }
}
```

### 存檔與載入功能

**自動存檔機制**
- **增量自動存檔**：每 5 分鐘自動保存變更內容
- **操作觸發存檔**：重要操作（如 CPM 分析、任務合併）後立即存檔
- **版本控制整合**：自動建立 Git commit 記錄變更歷史
- **備份保留策略**：保留最近 10 個自動存檔版本

**手動存檔控制**
```python
class ProjectFileManager:
    def save_project(self, file_path: str, include_results: bool = True) -> bool:
        """
        保存完整專案狀態到 .bpx 檔案
        
        參數:
            file_path: 目標檔案路徑
            include_results: 是否包含分析結果
        
        回傳:
            操作成功與否
        """
        
    def load_project(self, file_path: str) -> ProjectState:
        """
        從 .bpx 檔案載入專案狀態
        
        參數:
            file_path: 來源檔案路徑
            
        回傳:
            完整的專案狀態物件
        """
        
    def export_partial(self, components: List[str], format: str) -> str:
        """
        部分匯出功能
        
        參數:
            components: 要匯出的元件清單 ['wbs', 'dsm', 'results']
            format: 匯出格式 ('csv', 'excel', 'json')
        """
```

**載入驗證機制**
- **版本相容性檢查**：確保檔案格式與系統版本相容
- **資料完整性驗證**：檢查 checksum 與檔案結構
- **依賴關係驗證**：確保 DSM 與 WBS 的 Task_ID 一致性
- **錯誤修復建議**：對於不相容或損壞的檔案提供修復選項

### GUI 整合功能

**檔案選單整合**
```
檔案 (File)
├── 新增專案 (Ctrl+N)
├── 開啟專案... (Ctrl+O)
├── 儲存專案 (Ctrl+S)
├── 另存新檔... (Ctrl+Shift+S)
├── ───────────────
├── 匯入
│   ├── 匯入 WBS 檔案...
│   ├── 匯入 DSM 檔案...
│   ├── 匯入 Resources 檔案...
│   └── 匯入資料夾...
├── 匯出
│   ├── 匯出合併後的 WBS
│   ├── 匯出合併後的 DSM
│   ├── 匯出甘特圖
│   └── 匯出分析報告...
├── ───────────────
├── 最近開啟的專案
└── 結束 (Alt+F4)
```

**專案狀態指示器**
- **標題列顯示**：當前專案名稱與修改狀態標記（*）
- **狀態列資訊**：最後存檔時間、自動存檔狀態、檔案大小
- **變更追蹤**：即時顯示未存檔的變更內容

**快速存檔功能**
- **Ctrl+S 快速存檔**：保存到當前檔案位置
- **Ctrl+Shift+S 另存新檔**：選擇新的檔案位置與名稱
- **自動恢復機制**：程式異常關閉時自動恢復未存檔內容

### 雲端同步支援

**Google Drive 整合**
```python
class CloudSyncManager:
    def sync_to_drive(self, project_file: str, drive_folder: str) -> bool:
        """同步專案檔案到 Google Drive"""
        
    def load_from_drive(self, drive_file_id: str) -> str:
        """從 Google Drive 載入專案檔案"""
        
    def enable_auto_sync(self, interval_minutes: int = 30) -> None:
        """啟用自動雲端同步"""
```

**衝突解決機制**
- **三方合併**：自動偵測並合併不衝突的變更
- **衝突標記**：對於衝突的資料提供視覺化比較介面
- **版本分支**：保留多個版本供使用者選擇

**離線工作支援**
- **本地快取**：離線時繼續工作，連線後自動同步
- **變更佇列**：記錄離線期間的所有變更操作
- **同步狀態指示**：即時顯示雲端同步狀態

### 協作功能擴展

**多人協作支援**
- **檔案鎖定機制**：防止同時編輯造成的資料衝突
- **變更通知**：團隊成員的即時變更推播
- **權限管理**：不同角色的檔案存取權限控制

**版本歷史管理**
```python
class VersionHistoryManager:
    def create_snapshot(self, description: str) -> str:
        """建立專案快照"""
        
    def list_versions(self) -> List[VersionInfo]:
        """列出所有版本歷史"""
        
    def restore_version(self, version_id: str) -> bool:
        """恢復到指定版本"""
        
    def compare_versions(self, v1: str, v2: str) -> ComparisonResult:
        """比較兩個版本的差異"""
```

**分支管理功能**
- **實驗性分析**：建立分支進行假設性分析而不影響主專案
- **場景比較**：並排比較不同方案的分析結果
- **合併策略**：靈活的分支合併與衝突解決

### 安全性與備份

**資料加密保護**
- **檔案層級加密**：使用 AES-256 加密敏感專案資料
- **密碼保護**：支援密碼保護的專案檔案
- **數位簽章**：確保檔案來源與完整性

**自動備份策略**
- **本地備份**：在系統暫存目錄建立多個備份副本
- **雲端備份**：定期上傳到指定的雲端儲存服務
- **增量備份**：只備份變更的部分，節省儲存空間與時間

**災難恢復機制**
- **損壞檔案修復**：嘗試從備份或部分資料重建專案
- **緊急匯出**：在系統異常時快速匯出關鍵資料
- **恢復精靈**：逐步引導使用者進行資料恢復

## 系統發展路線圖與架構

### 微服務架構設計

**整體平台架構**
```
Birdman Project 平台
├── RACP 最佳化引擎
├── RCPSP 排程服務
├── 資源建模層
├── 行事曆整合閘道
├── 文件生成服務
├── 可用性預測系統
├── 技能發展追蹤器
└── AI 增強決策支援
```

**核心服務間通訊**
各微服務透過標準化 REST API 與 gRPC 進行通訊，確保系統的可擴展性與維護性。每個服務都具備獨立的資料存儲與業務邏輯，支援水平擴展與故障隔離。

### 分階段開發計畫

**第一階段：核心演算法實作**（第 1-4 個月）
專注於建立系統的數學基礎與核心最佳化能力。這個階段的目標是確保所有基礎演算法都能正確運作，為後續的功能擴展提供穩固基礎。

RACP 演算法開發將從支援多技能群組成員開始，實作基本的二分搜尋法與線性規劃求解器整合。同時開發適用於學生團隊的基礎 RCPSP 實作，處理變動工時與技能等級約束。資源建模的基礎架構將支援單人任務與平行任務的分配邏輯。

**第二階段：整合與強化**（第 5-8 個月）
將各個獨立模組整合成完整的系統，並加入學術環境的特殊需求處理。

行事曆整合將與主要學術排程系統建立連接，包含 Google Calendar、Outlook 與校務系統的 API 串接。協作任務建模將實作同步機制，支援分散式團隊的協調工作。AI 可讀文件框架的建立將確保所有技術規範都能被自動化工具正確解析與處理。

**第三階段：進階功能與最佳化**（第 9-12 個月）
加入智慧化功能與效能最佳化，讓系統能夠處理大規模專案並提供預測性分析。

變動可用性演算法將整合不確定性處理機制，使用強健最佳化技術應對學生可用性的波動。機器學習整合將提供預測性排程功能，基於歷史資料改善資源分配決策。效能最佳化與可擴展性改進將確保系統能夠支援多個並行專案的分析與管理。

### 技術堆疊建議

**核心平台技術**
後端開發建議使用 Python 搭配 FastAPI 框架，提供高效能的 API 開發能力。數學最佳化部分整合 OR-Tools、PuLP 與 CPLEX 等專業求解器。資料庫選擇 PostgreSQL 搭配 TimescaleDB 擴充，專門處理時間序列的可用性資料。快取層使用 Redis 來儲存頻繁存取的排程計算結果。

**整合層技術**
行事曆整合支援 Google Calendar API、Microsoft Graph API 與 CalDAV 標準實作。文件生成使用 MkDocs 搭配 JSON Schema 驗證機制。機器學習部分採用 scikit-learn 與 TensorFlow 進行預測演算法開發。系統監控使用 Prometheus 與 Grafana 提供效能追蹤能力。

### 創新成果展望

**多技能群組最佳化**讓資源能夠在重疊技能領域間進行高效分配，大幅提升人力利用效率。**學術感知排程**能夠適應教育環境的複雜時間約束，自動調整專案時程以配合學期安排。**適應性學習整合**基於使用模式與成果的持續系統改進，讓排程決策越來越精準。**完整文件框架**同時支援人類理解與自動化系統生成，確保知識的有效傳承與技術債務的最小化。

這些技術需求為開發下一代專案管理平台提供了強健的基礎，結合理論嚴謹性與實用性，確保在最佳化資源利用的同時保持學術專案成功所必需的彈性。

### config.json 設定檔結構

**CPM 分析參數**
```json
{
  "cmp_params": {
    "work_hours_per_day": 8,
    "working_days_per_week": 5,
    "default_duration_field": "Te_newbie",
    "project_start_date": null,
    "time_unit": "hours"
  }
}
```

**任務合併參數**
```json
{
  "merge_k_params": {
    "base": 1.0,
    "trf_scale": 1.0,
    "trf_divisor": 10.0,
    "n_coef": 0.1,
    "override": null
  }
}
```

**視覺化參數**
```json
{
  "visualization_params": {
    "node_color": "skyblue",
    "scc_color_palette": ["#FFD700", "#FF8C00", "#FF6347"],
    "merged_node_color": "lightcoral",
    "font_size": 8
  }
}
```

### 動態參數調整

**GUI 參數設定對話框**
提供圖形介面即時調整 k 係數參數，支援：
- 基礎係數與縮放參數的數值輸入
- 覆寫模式的啟用與禁用
- 參數驗證與錯誤提示
- 即時保存至 config.json

## 資料驗證與錯誤處理

### 資料一致性檢查

**DSM 格式驗證**
- 確保矩陣為方陣（行列數相等）
- 檢查 Task_ID 的一致性與唯一性
- 驗證矩陣值僅包含 0 或 1

**WBS 完整性檢查**
- 必要欄位存在性驗證
- Task_ID 格式規範檢查
- TRF 數值範圍驗證（非負數）
- 工時欄位的數值有效性

**依賴關係驗證**
- 循環依賴檢測與提示
- 孤立任務識別與警告
- 依賴關係的合理性分析

### 異常處理機制

**錯誤分類與回應**
- **格式錯誤**：提供具體的修正建議
- **數值錯誤**：標示問題欄位與期望範圍
- **邏輯錯誤**：解釋依賴關係衝突原因
- **運算錯誤**：記錄詳細錯誤日誌

**容錯處理策略**
- 自動補充缺失的預設值
- 提供多種數據修復選項
- 支援部分資料的獨立處理

## 匯出功能與報告生成

### 支援格式規範

**表格資料匯出**
- CSV 格式：UTF-8 編碼，支援中文
- Excel 格式：含格式化與顏色標示
- 自動添加時間戳與版本資訊

**圖表匯出功能**
- PNG 格式：300 DPI 高解析度，適合印刷
- SVG 格式：向量圖形，支援無損縮放
- 自動邊距調整與背景色適配

**報告生成模板**
- CPM 分析報告：包含關鍵路徑、總工期、風險評估
- RCPSP 排程報告：含資源利用率與最佳化結果
- 蒙地卡羅風險報告：統計指標與信心水準分析

### 批次匯出功能

**檔案選單整合**
所有匯出功能統一整合至檔案選單，支援：
- 分類別的子選單組織
- 格式選擇與路徑指定
- 匯出進度顯示與錯誤處理

## 效能需求與最佳化

### 運算效能指標

**任務規模支援**
- 支援 500+ 任務的大型專案
- DSM 處理：O(n²) 複雜度，n ≤ 1000
- CPM 計算：O(n+e) 複雜度，線性可擴展
- RCPSP 求解：10 秒時間限制內完成

**記憶體使用最佳化**
- 大型資料的分批處理
- 不必要物件的及時釋放
- 圖表快取機制減少重複計算

### 並行處理支援

**蒙地卡羅模擬最佳化**
- 背景執行緒避免 UI 阻塞
- 進度條即時更新
- 可中斷的模擬流程控制

**多核心運算支援**
利用 Python multiprocessing 進行平行化處理，特別是：
- 大量 CPM 情境計算
- 蒙地卡羅樣本生成
- 圖表並行渲染

## 安全性與資料保護

### 資料安全機制

**版本控制整合**
- 所有檔案修改自動 Git 追蹤
- 操作日誌記錄至 AI_LOG.md
- 支援歷史版本回復功能

**輸入驗證與清理**
- 嚴格的資料格式驗證
- SQL 注入防護（若未來擴展資料庫）
- 檔案路徑安全性檢查

**API 安全性**
- 認證權限控制
- 存取頻率限制
- 敏感資料加密傳輸

### 備份與恢復機制

**自動備份策略**
- 每次重要操作前自動備份
- 支援多版本備份保留
- 快速恢復與一鍵還原功能

## 擴展性與未來發展

### 模組化設計原則

**解耦合架構**
- 清晰的介面定義與依賴注入
- 插件式演算法支援
- 可獨立測試的模組組件

**新演算法集成**
- 支援第三方最佳化求解器整合
- 可替換的風險分佈模型
- 擴展的視覺化引擎介面

### 雲端服務化路徑

**容器化部署**
- Docker 容器支援
- Kubernetes 橫向擴展
- 微服務架構轉換準備

**多租戶支援**
- 資料隔離與權限管理
- 客製化設定與品牌
- 用量計費與資源監控

### 人工智慧增強

**智慧化任務估時**
- 基於歷史資料的機器學習預測
- 動態 TRF 評估與調整建議
- 風險預警與最佳化建議

**自動化報告生成**
- 自然語言生成專案摘要
- 智慧化風險分析與建議
- 個性化儀表板與通知

## 測試與品質保證

### 測試覆蓋範圍

**單元測試要求**
- 核心演算法模組 ≥ 90% 覆蓋率
- 資料處理函式 ≥ 95% 覆蓋率
- 邊界條件與異常情況完整測試

**整合測試範圍**
- CLI 與 GUI 功能完整性
- 檔案 I/O 與格式轉換
- 跨模組資料流正確性

**效能測試基準**
- 大規模資料處理壓力測試
- 記憶體洩漏與資源使用監控
- 長時間運行穩定性驗證

### 程式碼品質標準

**程式碼風格規範**
- flake8 靜態分析檢查
- 120 字元行長度限制
- 完整的中文註解要求

**文件化要求**
- 所有公開 API 的 docstring
- README 與 AGENTS 同步更新
- 變更記錄 AI_LOG.md 完整維護

## 部署與維護

### 部署需求

**最低系統需求**
- Python 3.10+ 運行環境
- 2GB RAM + 1GB 可用磁碟空間
- 網路連接（用於套件安裝與更新）

**推薦運行環境**
- 4GB RAM 以上（大型專案分析）
- SSD 儲存（提升檔案 I/O 效能）
- 多核心 CPU（並行計算最佳化）

**套件管理**
- requirements.txt 完整依賴清單
- 虛擬環境隔離部署
- 一鍵安裝腳本支援

### 維護與更新機制

**版本管理策略**
- 語意化版本號（Semantic Versioning）
- 向後相容性保證
- 明確的升級路徑與指引

**日誌與監控**
- 詳細的操作日誌記錄
- 錯誤追蹤與警報機制
- 效能監控與分析工具

**社群支援**
- GitHub Issues 問題追蹤
- 完整的使用說明文件
- 範例資料與教學資源

---

本需求文件為 Birdman Project 的技術實作提供完整指導，所有開發與修改均應遵循此規範，確保系統的一致性、可維護性與可擴展性。