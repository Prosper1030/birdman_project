# ç¸½çµ

æˆ‘å·²ç¶“å®Œæˆäº† DSM ç·¨è¼¯å™¨çš„æ¨¡çµ„åŒ–é‡æ§‹ï¼Œä»¥ä¸‹æ˜¯å®Œæˆçš„å…§å®¹ï¼š

### âœ… 1. **æ¨¡çµ„åŒ– DSM ç·¨è¼¯å™¨**

- å°‡éšå±¤å¼ä½ˆå±€æ¼”ç®—æ³•æŠ½é›¢åˆ° `src/layouts/`[`hierarchical.py`](hierarchical.py)

- ä¿æŒç¾æœ‰çš„ Longest-Path åˆ†å±¤é‚è¼¯

- æä¾›äº†ä¿®æ”¹ `dsm_`[`editor.py`](editor.py) çš„å…·é«”ç¨‹å¼ç¢¼ç‰‡æ®µ

### âœ… 2. **å»ºç«‹å¯æ“´å±•çš„æª”æ¡ˆéª¨æ¶**

#### ğŸ“„ `src/layouts/`[`hierarchical.py`](hierarchical.py)

- å¯¦ä½œ `layout_hierarchical()` å‡½æ•¸ï¼Œå›å‚³ `{task_id: (x, y)}`

- ä¿ç•™ç¾æœ‰é‚è¼¯ï¼ˆLongest-Path + ç­‰è·æ“ºä½ï¼‰

- åŠ å…¥ TODO è¨»è§£æ¨™ç¤ºæœªä¾†å„ªåŒ–æ–¹å‘

- åŒ…å«å‚™ç”¨æ–¹æ¡ˆè™•ç†å¾ªç’°åœ–

#### ğŸ“„ `src/ui/routed_edge_`[`item.py`](item.py)

- å»ºç«‹ `RoutedEdgeItem` é¡åˆ¥éª¨æ¶

- æ”¯æ´ polyline è·¯å¾‘è¨­å®š

- é ç•™å¹³è¡Œé‚Šåç§»ã€é¸å–æ¨£å¼ã€hover ç­‰æ¥å£

- åŒ…å« `RoutedEdgeManager` ç®¡ç†é¡åˆ¥

#### ğŸ“„ `run_dsm_`[`editor.py`](editor.py)

- æœ€å°å•Ÿå‹•å™¨ï¼Œå¯è®€å– sample è³‡æ–™

- æ”¯æ´ `--wbs` åƒæ•¸æŒ‡å®šæª”æ¡ˆ

- æ”¯æ´ `--direction` åƒæ•¸è¨­å®šä½ˆå±€æ–¹å‘

- åŒ…å«è©³ç´°çš„ä½¿ç”¨èªªæ˜å’Œæ“ä½œæŒ‡å—

#### ğŸ“„ `tests/layouts/test_`[`hierarchical.py`](hierarchical.py)

- æ¸¬è©¦ `layout_hierarchical()` åŸºæœ¬åŠŸèƒ½

- é©—è­‰é‡è¤‡åŸ·è¡Œçš„ç¢ºå®šæ€§ï¼ˆRMS < 1e-6ï¼‰

- æ¸¬è©¦å„ç¨®é‚Šç•Œæ¢ä»¶ï¼ˆç©º WBSã€å–®ç¯€é»ã€å¾ªç’°åœ–ç­‰ï¼‰

### âœ… 3. **ä¿æŒç¾æœ‰è¡Œç‚º**

- éšå±¤å¼ä½ˆå±€çµæœèˆ‡ç¾åœ¨ä¸€è‡´

- æœªå¼•å…¥æ–°çš„ç¬¬ä¸‰æ–¹å¥—ä»¶

- æœ€å°æ”¹å‹•é”åˆ°æ¨¡çµ„åŒ–

### ğŸ“ é‡æ§‹æŒ‡å¼•

ä¿®æ”¹ `src/ui/dsm_`[`editor.py`](editor.py) æ™‚ï¼Œè«‹æŒ‰ç…§ä»¥ä¸‹æ­¥é©Ÿï¼š

1. **åŠ å…¥ import**ï¼š

```python
from ..layouts.hierarchical import layout_hierarchical
from .routed_edge_item import RoutedEdgeItem, RoutedEdgeManager

```

1. **æ›¿æ› `applyHierarchicalLayout` æ–¹æ³•**ï¼ˆä½¿ç”¨æˆ‘æä¾›çš„ç¨‹å¼ç¢¼ï¼‰

2. **åˆªé™¤ `applySimpleHierarchicalLayout` æ–¹æ³•**ï¼ˆå·²ç§»åˆ°æ¨¡çµ„å…§ï¼‰

3. **ï¼ˆé¸ç”¨ï¼‰åœ¨ `__init__` åŠ å…¥ `RoutedEdgeManager` å¯¦ä¾‹**

### ğŸš€ ä½¿ç”¨æ–¹å¼

```python
# åŸ·è¡Œç·¨è¼¯å™¨
python run_dsm_editor.py

# æŒ‡å®š WBS æª”æ¡ˆ
python run_dsm_editor.py --wbs sample_data/WBS.csv

# è¨­å®šä½ˆå±€æ–¹å‘
python run_dsm_editor.py --direction LR

# åŸ·è¡Œæ¸¬è©¦
python tests/layouts/test_hierarchical.py

```

### ğŸ“Œ å¾ŒçºŒ TODO

- æ•´åˆ `EdgeRoutingEngine` åˆ° `RoutedEdgeItem`

- å¯¦ä½œäº¤å‰æœ€å°åŒ–æ¼”ç®—æ³•

- æ”¯æ´ dummy nodes è™•ç†è·¨å±¤é‚Š

- å¯¦ä½œä½ˆå±€å£“ç¸®å„ªåŒ–

æ‰€æœ‰æª”æ¡ˆéƒ½åŒ…å«è©³ç´°è¨»è§£å’Œ TODO æ¨™è¨˜ï¼Œæ–¹ä¾¿æœªä¾†æ“´å±•ã€‚